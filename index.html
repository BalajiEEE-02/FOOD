<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FoodCo Pro | Executive Suite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --primary: #4f46e5; --dark: #0f172a; }
        .glass { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); }
        .sidebar-item { transition: all 0.3s; cursor: pointer; }
        .sidebar-item:hover { background: rgba(255,255,255,0.1); border-left: 4px solid #6366f1; }
        .active-tab { background: #4f46e5 !important; border-left: 4px solid #fff; }
        input, select, textarea { border: 1px solid #e2e8f0; padding: 8px 12px; border-radius: 8px; width: 100%; }
    </style>
</head>
<body class="bg-slate-100 text-slate-900">

    <div class="flex h-screen">
        <aside class="w-72 bg-slate-900 text-white flex flex-col shadow-2xl">
            <div class="p-6">
                <h1 class="text-2xl font-black tracking-tighter text-indigo-400">FOODCO <span class="text-white">PRO</span></h1>
                <p class="text-xs text-slate-400 mt-1">Enterprise Food Management</p>
            </div>
            
            <nav class="flex-1 px-4 space-y-2 font-medium">
                <div onclick="showTab('home')" id="tab-home" class="sidebar-item p-4 rounded-xl flex items-center gap-3 active-tab"><i class="fas fa-th-large"></i> Dashboard</div>
                <div onclick="showTab('members')" id="tab-members" class="sidebar-item p-4 rounded-xl flex items-center gap-3"><i class="fas fa-user-plus"></i> Members & Groups</div>
                <div onclick="showTab('finance')" id="tab-finance" class="sidebar-item p-4 rounded-xl flex items-center gap-3"><i class="fas fa-file-invoice-dollar"></i> Finance Ledger</div>
                <div onclick="showTab('menu')" id="tab-menu" class="sidebar-item p-4 rounded-xl flex items-center gap-3"><i class="fas fa-utensils"></i> Session Menu</div>
                <div onclick="showTab('attendance')" id="tab-attendance" class="sidebar-item p-4 rounded-xl flex items-center gap-3"><i class="fas fa-calendar-check"></i> Attendance</div>
                <div onclick="showTab('reports')" id="tab-reports" class="sidebar-item p-4 rounded-xl flex items-center gap-3"><i class="fas fa-chart-line"></i> Statistics</div>
            </nav>

            <div class="p-6 border-t border-slate-800">
                <button onclick="googleSignIn()" class="w-full flex items-center justify-center gap-2 bg-white text-slate-900 p-3 rounded-xl font-bold hover:bg-slate-200 transition">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/action/google.svg" class="w-5"> Google Sign-in
                </button>
            </div>
        </aside>

        <main class="flex-1 overflow-y-auto relative">
            
            <section id="home" class="p-8 space-y-8 block">
                <div class="flex justify-between items-end">
                    <div>
                        <h2 class="text-3xl font-bold">Welcome Back, Manager</h2>
                        <p class="text-slate-500" id="current-date">--</p>
                    </div>
                    <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-200 text-right">
                        <span class="text-xs font-bold text-slate-400 block uppercase">Days Left in Month</span>
                        <span id="days-left" class="text-3xl font-black text-indigo-600">--</span>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-indigo-600 p-6 rounded-3xl text-white shadow-xl">
                        <i class="fas fa-users mb-4 text-2xl opacity-50"></i>
                        <h4 class="text-lg opacity-80">Total Eaters</h4>
                        <p id="home-total-students" class="text-4xl font-black">0</p>
                    </div>
                    <div class="bg-white p-6 rounded-3xl border border-slate-200 shadow-sm">
                        <i class="fas fa-utensils mb-4 text-2xl text-orange-500"></i>
                        <h4 class="text-lg text-slate-500">Lunch Session</h4>
                        <p id="home-menu" class="text-2xl font-bold text-slate-800">Not Set</p>
                    </div>
                    <div class="bg-white p-6 rounded-3xl border border-slate-200 shadow-sm">
                        <i class="fas fa-wallet mb-4 text-2xl text-green-500"></i>
                        <h4 class="text-lg text-slate-500">Total Collection</h4>
                        <p id="home-total-cash" class="text-2xl font-bold text-slate-800">₹ 0</p>
                    </div>
                </div>
                <img src="https://images.unsplash.com/photo-1555396273-367ea4eb4db5?auto=format&fit=crop&w=1200&q=80" class="w-full h-80 object-cover rounded-[2rem] shadow-2xl">
            </section>

            <section id="members" class="p-8 hidden space-y-6">
                <div class="flex justify-between items-center">
                    <h2 class="text-3xl font-bold">Member Management</h2>
                    <button onclick="openModal('member-modal')" class="bg-indigo-600 text-white px-6 py-2 rounded-xl font-bold">+ Add New</button>
                </div>
                <div class="bg-white rounded-2xl shadow overflow-hidden">
                    <table class="w-full text-left border-collapse">
                        <thead class="bg-slate-50 border-b">
                            <tr>
                                <th class="p-4">Student Name</th>
                                <th class="p-4">Dept</th>
                                <th class="p-4">Year</th>
                                <th class="p-4">Phone</th>
                                <th class="p-4">Status</th>
                                <th class="p-4">Action</th>
                            </tr>
                        </thead>
                        <tbody id="member-list"></tbody>
                    </table>
                </div>
            </section>

            <section id="finance" class="p-8 hidden space-y-6">
                <h2 class="text-3xl font-bold">Finance & Cash Flow</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-2xl shadow-lg border-t-4 border-green-500">
                        <h3 class="text-xl font-bold mb-4 text-green-700">Receive Payment</h3>
                        <div class="space-y-4">
                            <select id="pay-student-name" class="bg-slate-50"></select>
                            <div class="grid grid-cols-2 gap-4">
                                <input type="number" id="pay-amount" placeholder="Amount (₹)">
                                <select id="pay-method">
                                    <option>GPay</option>
                                    <option>Cash</option>
                                </select>
                            </div>
                            <button onclick="recordPayment()" class="w-full bg-green-600 text-white font-bold py-3 rounded-xl">Add to Vault</button>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-lg border-t-4 border-red-500">
                        <h3 class="text-xl font-bold mb-4 text-red-700">Company Spending</h3>
                        <div class="space-y-4">
                            <select id="spend-type">
                                <option>Food Materials</option>
                                <option>Labour Salary</option>
                            </select>
                            <input type="number" id="spend-amount" placeholder="Amount Spent (₹)">
                            <textarea id="spend-desc" placeholder="Details (e.g. 50kg Rice)"></textarea>
                            <button onclick="recordSpend()" class="w-full bg-red-600 text-white font-bold py-3 rounded-xl">Deduct Funds</button>
                        </div>
                    </div>
                </div>
            </section>

            <section id="reports" class="p-8 hidden space-y-8">
                <h2 class="text-3xl font-bold">Analytics & Reports</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-2xl shadow"><canvas id="deptChart"></canvas></div>
                    <div class="bg-white p-6 rounded-2xl shadow"><canvas id="financeChart"></canvas></div>
                </div>
            </section>

            <section id="menu" class="p-8 hidden space-y-6">
                <h2 class="text-3xl font-bold">Session Menu Manager</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="menu-grid">
                    </div>
            </section>

        </main>
    </div>

    <div id="member-modal" class="fixed inset-0 bg-black/50 hidden flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-3xl w-full max-w-md shadow-2xl">
            <h3 class="text-2xl font-bold mb-6">Register New Member</h3>
            <div class="space-y-4">
                <input type="text" id="m-name" placeholder="Full Name">
                <select id="m-dept">
                    <option>AIDS</option><option>AIML</option><option>CIVIL</option><option>CHEMICAL</option>
                    <option>EEE</option><option>ECE</option><option>CSE</option><option>IT</option>
                    <option>MECHANICAL</option><option>CCE</option><option>CSBS</option>
                </select>
                <select id="m-year">
                    <option>1st Year</option><option>2nd Year</option><option>3rd Year</option><option>Final Year</option>
                </select>
                <input type="text" id="m-phone" placeholder="Phone Number">
                <div class="flex gap-2 pt-4">
                    <button onclick="closeModal('member-modal')" class="flex-1 bg-slate-200 font-bold p-3 rounded-xl">Cancel</button>
                    <button onclick="saveMember()" class="flex-1 bg-indigo-600 text-white font-bold p-3 rounded-xl">Save Member</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- DATABASE INITIALIZATION (INDEXED DB) ---
        let db;
        const request = indexedDB.open("FoodCoSystem", 1);

        request.onupgradeneeded = (e) => {
            db = e.target.result;
            db.createObjectStore("members", { keyPath: "id", autoIncrement: true });
            db.createObjectStore("finance", { keyPath: "id", autoIncrement: true });
            db.createObjectStore("sessions", { keyPath: "id" });
        };

        request.onsuccess = (e) => {
            db = e.target.result;
            init();
        };

        // --- CORE UI LOGIC ---
        function showTab(id) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active-tab'));
            document.getElementById(id).classList.remove('hidden');
            document.getElementById('tab-' + id).classList.add('active-tab');
            if(id === 'reports') renderCharts();
            if(id === 'members') loadMembers();
            if(id === 'finance') updateFinanceDropdowns();
        }

        function openModal(id) { document.getElementById(id).classList.remove('hidden'); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }

        function init() {
            // Set Date
            document.getElementById('current-date').innerText = new Date().toDateString();
            
            // Calculate Days Left
            const today = new Date();
            const lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 0).getDate();
            document.getElementById('days-left').innerText = lastDay - today.getDate();
            
            loadMembers();
            updateDashboard();
        }

        // --- MEMBER MANAGEMENT ---
        function saveMember() {
            const member = {
                name: document.getElementById('m-name').value,
                dept: document.getElementById('m-dept').value,
                year: document.getElementById('m-year').value,
                phone: document.getElementById('m-phone').value,
                joinDate: new Date().toLocaleDateString(),
                status: 'Active'
            };
            const tx = db.transaction("members", "readwrite");
            tx.objectStore("members").add(member);
            tx.oncomplete = () => {
                closeModal('member-modal');
                loadMembers();
                updateDashboard();
            };
        }

        function loadMembers() {
            const list = document.getElementById('member-list');
            list.innerHTML = "";
            const tx = db.transaction("members", "readonly");
            tx.objectStore("members").openCursor().onsuccess = (e) => {
                const cursor = e.target.result;
                if(cursor) {
                    list.innerHTML += `
                        <tr class="border-b hover:bg-slate-50">
                            <td class="p-4 font-bold">${cursor.value.name}</td>
                            <td class="p-4">${cursor.value.dept}</td>
                            <td class="p-4 text-xs bg-indigo-100 text-indigo-700 rounded inline-block m-4">${cursor.value.year}</td>
                            <td class="p-4">${cursor.value.phone}</td>
                            <td class="p-4"><span class="text-green-500 font-bold">● Active</span></td>
                            <td class="p-4"><button class="text-red-400 hover:text-red-600"><i class="fas fa-trash"></i></button></td>
                        </tr>
                    `;
                    cursor.continue();
                }
            };
        }

        // --- FINANCE LOGIC ---
        function recordPayment() {
            const entry = {
                type: 'Income',
                name: document.getElementById('pay-student-name').value,
                amount: parseFloat(document.getElementById('pay-amount').value),
                method: document.getElementById('pay-method').value,
                date: new Date().toLocaleDateString()
            };
            const tx = db.transaction("finance", "readwrite");
            tx.objectStore("finance").add(entry);
            tx.oncomplete = () => { alert("Payment Saved!"); updateDashboard(); };
        }

        function recordSpend() {
            const entry = {
                type: 'Expense',
                category: document.getElementById('spend-type').value,
                amount: parseFloat(document.getElementById('spend-amount').value),
                desc: document.getElementById('spend-desc').value,
                date: new Date().toLocaleDateString()
            };
            const tx = db.transaction("finance", "readwrite");
            tx.objectStore("finance").add(entry);
            tx.oncomplete = () => { alert("Expense Recorded!"); updateDashboard(); };
        }

        function updateFinanceDropdowns() {
            const drop = document.getElementById('pay-student-name');
            drop.innerHTML = "";
            const tx = db.transaction("members", "readonly");
            tx.objectStore("members").openCursor().onsuccess = (e) => {
                const cursor = e.target.result;
                if(cursor) {
                    drop.innerHTML += `<option>${cursor.value.name}</option>`;
                    cursor.continue();
                }
            };
        }

        // --- DASHBOARD & ANALYTICS ---
        function updateDashboard() {
            const txM = db.transaction("members", "readonly");
            const countReq = txM.objectStore("members").count();
            countReq.onsuccess = () => { document.getElementById('home-total-students').innerText = countReq.result; };

            let totalIn = 0;
            const txF = db.transaction("finance", "readonly");
            txF.objectStore("finance").openCursor().onsuccess = (e) => {
                const cursor = e.target.result;
                if(cursor) {
                    if(cursor.value.type === 'Income') totalIn += cursor.value.amount;
                    cursor.continue();
                }
                document.getElementById('home-total-cash').innerText = "₹ " + totalIn.toLocaleString();
            };
        }

        function renderCharts() {
            // Chart 1: Collection by Year
            new Chart(document.getElementById('deptChart'), {
                type: 'doughnut',
                data: {
                    labels: ['1st Year', '2nd Year', '3rd Year', 'Final Year'],
                    datasets: [{
                        data: [40, 30, 20, 10],
                        backgroundColor: ['#4f46e5', '#818cf8', '#c7d2fe', '#e0e7ff']
                    }]
                },
                options: { plugins: { title: { display: true, text: 'Student Distribution %' } } }
            });

            // Chart 2: Finance Weekly
            new Chart(document.getElementById('financeChart'), {
                type: 'bar',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri'],
                    datasets: [{
                        label: 'Income',
                        data: [5000, 7000, 3000, 8000, 4000],
                        backgroundColor: '#22c55e'
                    }, {
                        label: 'Expense',
                        data: [2000, 3000, 1500, 4000, 2000],
                        backgroundColor: '#ef4444'
                    }]
                }
            });
        }

        function googleSignIn() {
            alert("Firebase Google Auth Triggered. Set up your Firebase Config to link this to your account.");
        }
    </script>
</body>
</html>
